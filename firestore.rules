rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===========================================
    // REGLA TEMPORAL PARA DESARROLLO
    // ⚠️ ESTA REGLA DA ACCESO TOTAL - ÚSALA PARA SOLUCIONAR TUS PROBLEMAS
    // ⚠️ EN PRODUCCIÓN, COMENTA ESTA LÍNEA Y USA LAS REGLAS ESPECÍFICAS
    // ===========================================
    
    match /{document=**} {
      allow read, write: if true;
    }
    
    // ===========================================
    // REGLAS ESPECÍFICAS PARA PRODUCCIÓN
    // Descomenta estas cuando quieras más seguridad
    // ===========================================
    
    /*
    // Función para verificar autenticación
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Función para verificar pertenencia a la finca
    function belongsToFinca(fincaId) {
      return fincaId == 'finca_la_herradura';
    }
    
    // Validar datos de gasto
    function isValidExpense(data) {
      return data.keys().hasAll(['amount', 'category', 'description', 'date']) &&
             data.amount is number && data.amount > 0 &&
             data.category is string && data.category.size() > 0 &&
             data.description is string && data.description.size() > 0 &&
             data.date is string;
    }
    
    // GASTOS DE LA FINCA
    match /gastos_finca/{gastoId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated() && isValidExpense(request.resource.data);
      allow update: if isAuthenticated() && isValidExpense(request.resource.data);
      allow delete: if isAuthenticated();
    }
    
    // GASTOS (colección alternativa)
    match /gastos/{gastoId} {
      allow read, write: if isAuthenticated();
    }
    
    // COSECHAS DIARIAS
    match /cosechas_diarias/{cosechaId} {
      allow read, write: if isAuthenticated();
    }
    
    // VENTAS DIRECTAS
    match /ventas_directas/{ventaId} {
      allow read, write: if isAuthenticated();
    }
    
    // RIEGOS
    match /riegos/{riegoId} {
      allow read, write: if isAuthenticated();
    }
    
    // ÁRBOLES
    match /arboles/{arbolId} {
      allow read, write: if isAuthenticated();
    }
    
    // PRECIOS MAGA - Acceso público para lectura
    match /precios_maga/{precioId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }
    
    // PRESUPUESTOS
    match /presupuestos_finca/{presupuestoId} {
      allow read, write: if isAuthenticated();
    }
    
    // CATEGORÍAS
    match /categorias_finca/{categoriaId} {
      allow read, write: if isAuthenticated();
    }
    
    // CONFIGURACIÓN
    match /configuracion_finca/{configId} {
      allow read, write: if isAuthenticated();
    }
    
    // Health checks y testing
    match /_health/{document} {
      allow read, write: if true;
    }
    
    match /_system/{document} {
      allow read: if true;
      allow write: if false;
    }
    */
  }
}

/*
INSTRUCCIONES DE USO:

1. Ve a Firebase Console: https://console.firebase.google.com
2. Selecciona tu proyecto "fincalaherradura-c5229"
3. Ve a "Firestore Database" en el menú lateral
4. Haz clic en la pestaña "Rules"
5. Reemplaza TODO el contenido actual con estas reglas
6. Haz clic en "Publish"

IMPORTANTE:
- La regla "allow read, write: if true" da acceso TOTAL a todos
- Esto solucionará tu error de permisos inmediatamente
- Para mayor seguridad, comenta esa línea y descomenta las reglas específicas
- En ese caso necesitarás configurar Firebase Authentication

PARA TESTING:
- Con estas reglas puedes leer y escribir desde cualquier lugar
- No necesitas autenticación por ahora
- Perfecto para desarrollo y testing
*/
